{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "58ab701d",
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import re\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "f8f23b03",
   "metadata": {},
   "outputs": [],
   "source": [
    "data = pd.read_csv('data1_tes.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "24898485",
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "# fungsi untuk konversi duration_string menjadi hours\n",
    "def convert_duration_hours(duration_str):\n",
    "    \n",
    "    # filter nilai NaN\n",
    "    if pd.isna(duration_str):\n",
    "        return 0\n",
    "    \n",
    "    # penyamaan format\n",
    "    duration_str = str(duration_str).lower()\n",
    "    \n",
    "    total_hours = 0\n",
    "    \n",
    "    # konversi nilai mengandung days\n",
    "    days_match = re.search(r'(\\d+)\\s*day', duration_str)\n",
    "    if days_match:\n",
    "        total_hours += int(days_match.group(1)) * 24\n",
    "    \n",
    "    # konversi nilai hanya mengandung hours \n",
    "    hours_match = re.search(r'(\\d+)\\s*hour', duration_str)\n",
    "    if hours_match:\n",
    "        total_hours += int(hours_match.group(1))\n",
    "    \n",
    "    return total_hours\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "1b36d1a7",
   "metadata": {},
   "outputs": [],
   "source": [
    "#aplikasikan fungsi ke data\n",
    "data['Stay_Duration_Hours'] = data['Duration_String'].apply(convert_duration_hours)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "6c30a7c6",
   "metadata": {},
   "outputs": [],
   "source": [
    "# identifikasi variasi guest_type\n",
    "variasi = data['Guest_Type'].unique()\n",
    "\n",
    "# pengelompokkan kategori guest_type\n",
    "var_new = []\n",
    "var_returning = []\n",
    "\n",
    "for i in variasi:\n",
    "    guest_type = str(i).lower()\n",
    "    \n",
    "    # Cek kategori New\n",
    "    if any(keyword in guest_type for keyword in ['new', 'baru', 'first']):\n",
    "        var_new.append(i)\n",
    "    # Cek kategori Returning  \n",
    "    elif any(keyword in guest_type for keyword in ['returning', 'repeat', 'kembali']):\n",
    "        var_returning.append(i)\n",
    "\n",
    "# mapping dictionary dari hasil pengelompokkan\n",
    "mapping_dict = {}\n",
    "\n",
    "# mapping variasi new\n",
    "for variant in var_new:\n",
    "    mapping_dict[variant] = 'New'\n",
    "\n",
    "# mapping variasi returning  \n",
    "for variant in var_returning:\n",
    "    mapping_dict[variant] = 'Returning'\n",
    "\n",
    "\n",
    "# aplikasikan ke dataframe\n",
    "data['Guest_Type'] = data['Guest_Type'].map(mapping_dict)\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "aa0d6fea",
   "metadata": {},
   "outputs": [],
   "source": [
    "# ubah tipe data check_in_date menjadi datetime\n",
    "data['Check_In_Date'] = pd.to_datetime(data['Check_In_Date'], errors='coerce')\n",
    "\n",
    "# tentukan batas data terfilter\n",
    "limit_date = pd.to_datetime('2024-01-01')\n",
    "\n",
    "# filter data\n",
    "data = data[data['Check_In_Date'] >= limit_date]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "4fe7c740",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "    Log_ID Guest_ID Check_In_Date   Duration_String Location_ID Guest_Type  \\\n",
      "0     1001    G1234    2024-03-15  2 days, 10 hours       LOC01        New   \n",
      "2     1003    G9012    2024-06-01   4 days, 0 hours       LOC01  Returning   \n",
      "3     1004    G3456    2024-01-05          10 hours       LOC02        New   \n",
      "4     1005    G7890    2024-07-20  5 days, 15 hours       LOC04  Returning   \n",
      "5     1006    G1122    2024-02-14    1 day, 2 hours       LOC05  Returning   \n",
      "6     1007    G3344    2024-08-01          18 hours       LOC01        New   \n",
      "7     1008    G5566    2024-04-22   3 days, 6 hours       LOC02        New   \n",
      "9     1010    G9900    2024-05-19  2 days, 20 hours       LOC04        New   \n",
      "10    1011    G0011    2024-01-01    1 day, 0 hours       LOC05  Returning   \n",
      "11    1012    G2233    2024-07-25           9 hours       LOC01  Returning   \n",
      "12    1013    G4455    2024-03-08  3 days, 12 hours       LOC02        New   \n",
      "14    1015    G8899    2024-06-15          14 hours       LOC04  Returning   \n",
      "15    1016    G1212    2024-02-29   4 days, 4 hours       LOC05        New   \n",
      "16    1017    G3434    2024-08-20   1 day, 16 hours       LOC01  Returning   \n",
      "17    1018    G5656    2024-04-01   5 days, 0 hours       LOC02        New   \n",
      "19    1020    G9090    2024-05-05  2 days, 18 hours       LOC04  Returning   \n",
      "20    1021    G1357    2024-01-10    1 day, 4 hours       LOC05  Returning   \n",
      "21    1022    G2468    2024-07-04          11 hours       LOC01        New   \n",
      "22    1023    G3579    2024-03-20   3 days, 8 hours       LOC02        New   \n",
      "24    1025    G5791    2024-06-30   1 day, 13 hours       LOC04  Returning   \n",
      "25    1026    G6802    2024-02-01  4 days, 16 hours       LOC05        New   \n",
      "26    1027    G7913    2024-08-15           6 hours       LOC01  Returning   \n",
      "27    1028    G8024    2024-04-10  2 days, 22 hours       LOC02        New   \n",
      "29    1030    G0246    2024-05-25  3 days, 10 hours       LOC04        New   \n",
      "30    1031    G1468    2024-01-22          12 hours       LOC05        New   \n",
      "31    1032    G2579    2024-07-11    5 days, 1 hour       LOC01  Returning   \n",
      "32    1033    G3680    2024-03-01    1 day, 7 hours       LOC02  Returning   \n",
      "33    1034    G4791    2024-05-15          16 hours       LOC03        New   \n",
      "34    1035    G5802    2024-06-08  2 days, 19 hours       LOC04        New   \n",
      "35    1036    G6913    2024-02-08   3 days, 0 hours       LOC05  Returning   \n",
      "36    1037    G7024    2024-08-25   1 day, 19 hours       LOC01  Returning   \n",
      "37    1038    G8135    2024-04-18   4 days, 5 hours       LOC02        New   \n",
      "39    1040    G0357    2024-05-01   2 days, 3 hours       LOC04  Returning   \n",
      "40    1041    G1479    2024-01-29   1 day, 23 hours       LOC05        New   \n",
      "41    1042    G2591    2024-07-28          17 hours       LOC01  Returning   \n",
      "42    1043    G3602    2024-03-25  3 days, 14 hours       LOC02        New   \n",
      "44    1045    G5824    2024-06-20    1 day, 9 hours       LOC04  Returning   \n",
      "45    1046    G6935    2024-02-18           5 hours       LOC05        New   \n",
      "47    1048    G8157    2024-04-29   2 days, 7 hours       LOC02  Returning   \n",
      "49    1050    G0379    2024-05-10   3 days, 5 hours       LOC04  Returning   \n",
      "\n",
      "    Stay_Duration_Hours  \n",
      "0                    58  \n",
      "2                    96  \n",
      "3                    10  \n",
      "4                   135  \n",
      "5                    26  \n",
      "6                    18  \n",
      "7                    78  \n",
      "9                    68  \n",
      "10                   24  \n",
      "11                    9  \n",
      "12                   84  \n",
      "14                   14  \n",
      "15                  100  \n",
      "16                   40  \n",
      "17                  120  \n",
      "19                   66  \n",
      "20                   28  \n",
      "21                   11  \n",
      "22                   80  \n",
      "24                   37  \n",
      "25                  112  \n",
      "26                    6  \n",
      "27                   70  \n",
      "29                   82  \n",
      "30                   12  \n",
      "31                  121  \n",
      "32                   31  \n",
      "33                   16  \n",
      "34                   67  \n",
      "35                   72  \n",
      "36                   43  \n",
      "37                  101  \n",
      "39                   51  \n",
      "40                   47  \n",
      "41                   17  \n",
      "42                   86  \n",
      "44                   33  \n",
      "45                    5  \n",
      "47                   55  \n",
      "49                   77  \n"
     ]
    }
   ],
   "source": [
    "print(data)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "9888a080",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.12"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
